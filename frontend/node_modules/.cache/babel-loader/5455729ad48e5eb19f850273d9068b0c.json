{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/dell/Documents/Proyects/Majo Floral Design/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/dell/Documents/Proyects/Majo Floral Design/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/dell/Documents/Proyects/Majo Floral Design/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import axios from\"axios\";import{Button,Form,Image}from\"react-bootstrap\";import FormContainer from\"../../components/FormContainer\";import Loader from\"../../components/Loader\";import Message from\"../../components/Message\";import Paginator from\"../../components/Paginator\";import{productDetails as details,updateProduct}from\"../../actions/product_actions\";import{listCategories}from\"../../actions/categorie_actions\";import{PRODUCT_DETAILS_RESET,PRODUCT_UPDATE_RESET}from\"../../constants/product_contants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function EditProductScreen(_ref){var match=_ref.match,history=_ref.history;/*Vars for creation of product*/var productId=match.params.id;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),description=_useState4[0],setDescription=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),price=_useState6[0],setPrice=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),image=_useState8[0],setImage=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),inStock=_useState10[0],setInStock=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isUploading=_useState12[0],setIsUploading=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),categorieName=_useState14[0],setCategorieName=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),categorieId=_useState16[0],setCategorieId=_useState16[1];var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var dispatch=useDispatch();var categorieList=useSelector(function(state){return state.categorieList;});var errorCategories=categorieList.error,loadingCategories=categorieList.loading,successCategories=categorieList.success,categories=categorieList.categories;var productDetails=useSelector(function(state){return state.productDetails;});var errorDetails=productDetails.error,loadingDetails=productDetails.loading,successDetails=productDetails.success,product=productDetails.product;var productUpdate=useSelector(function(state){return state.productUpdate;});var errorUpdate=productUpdate.error,loadingUpdate=productUpdate.loading,successUpdate=productUpdate.success;useEffect(function(){dispatch(listCategories());if(successUpdate){dispatch({type:PRODUCT_UPDATE_RESET});dispatch({type:PRODUCT_DETAILS_RESET});history.push(\"/admin/productos/\");}else{if(!(product===null||product===void 0?void 0:product.name)||product._id!==Number(productId))dispatch(details(productId));else{setName(product.name);setDescription(product.description);setPrice(product.price);setImage(product.img);setInStock(product.inStock);setCategorieName(product.categorie[\"name\"]);setCategorieId(product.categorie[\"_id\"]);}}},[product,productId,successUpdate,history,dispatch]);var uploadFileHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,formData,config,_yield$axios$post,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:file=e.target.files[0];formData=new FormData();formData.append(\"image\",file);formData.append(\"product_id\",productId);setIsUploading(true);_context.prev=5;config={headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(userInfo.token)}};_context.next=9;return axios.post(\"/api/products/upload/\",formData,config);case 9:_yield$axios$post=_context.sent;data=_yield$axios$post.data;setImage(data);setIsUploading(false);_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](5);console.log(_context.t0);setIsUploading(false);case 19:case\"end\":return _context.stop();}}},_callee,null,[[5,15]]);}));return function uploadFileHandler(_x){return _ref2.apply(this,arguments);};}();var submitHandler=function submitHandler(e){e.preventDefault();dispatch(updateProduct({name:name,_id:productId,description:description,category:categorieId,price:price,inStock:inStock}));};return loadingDetails?/*#__PURE__*/_jsx(\"div\",{style:{minHeight:\"100vh\",marginTop:\"15vh\"},children:/*#__PURE__*/_jsx(Loader,{})}):errorDetails?/*#__PURE__*/_jsx(\"div\",{style:{minHeight:\"100vh\",marginTop:\"15vh\"},children:/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:errorDetails})}):/*#__PURE__*/_jsx(\"div\",{style:{marginTop:\"10vh\"},children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(FormContainer,{children:[/*#__PURE__*/_jsx(\"h1\",{style:{width:\"100%\"},children:\"Editar producto\"}),/*#__PURE__*/_jsxs(Form,{onSubmit:submitHandler,children:[/*#__PURE__*/_jsxs(Form.Group,{controlId:\"name\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Nombre\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Ingresa el nombre\",value:name,onChange:function onChange(e){return setName(e.target.value);}})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"desc\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Descripci\\xF3n\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:3,placeholder:\"Ingresa los detalles\",value:description,onChange:function onChange(e){return setDescription(e.target.value);}})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"name\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Precio\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",placeholder:\"Ingresa el precio\",value:price,onChange:function onChange(e){return setPrice(e.target.value);}})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"categorie\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Categor\\xEDa\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"select\",custom:true,onChange:function onChange(e){return setCategorieId(e.target.value);},children:successCategories&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"option\",{selected:categorieId==undefined,children:\"Selecciona una categoria\"}),categories===null||categories===void 0?void 0:categories.map(function(categorie){return/*#__PURE__*/_jsx(\"option\",{value:categorie._id,selected:categorieId===categorie._id?true:false,children:categorie.name});})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"image\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Imagen\"}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex align-items-center w-100 justify-content-center\",children:(product===null||product===void 0?void 0:product.img)&&/*#__PURE__*/_jsx(Image,{className:\"d-block my-4 shadow\",style:{maxWidth:\"330px\",maxHeight:\"250px\"},xs:6,md:4,src:\"https://res.cloudinary.com/majo-floral-desing/\".concat(product.img)})}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Ingresa la imagen\",value:image,onChange:function onChange(e){return setImage(e.target.value);},readOnly:true}),/*#__PURE__*/_jsx(Form.File,{id:\"image-file\",label:\"Elegir un archivo\",custom:true,onChange:uploadFileHandler}),isUploading&&/*#__PURE__*/_jsx(Loader,{})]}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"stock\",children:/*#__PURE__*/_jsx(Form.Check,{type:\"checkbox\",label:\"¿Disponible en stock?\",checked:inStock,onChange:function onChange(e){return setInStock(!inStock);}})}),loadingUpdate?/*#__PURE__*/_jsx(Loader,{}):errorUpdate?categorieId==undefined?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\"Selecciona una categor\\xEDa\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Actualizar\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:errorUpdate}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Actualizar\"})]}):/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Actualizar\"})]})]})})});}","map":{"version":3,"sources":["C:/Users/dell/Documents/Proyects/Majo Floral Design/backend/frontend/src/views/EditProductScreen/index.js"],"names":["React","useState","useEffect","useDispatch","useSelector","axios","Button","Form","Image","FormContainer","Loader","Message","Paginator","productDetails","details","updateProduct","listCategories","PRODUCT_DETAILS_RESET","PRODUCT_UPDATE_RESET","EditProductScreen","match","history","productId","params","id","name","setName","description","setDescription","price","setPrice","image","setImage","inStock","setInStock","isUploading","setIsUploading","categorieName","setCategorieName","categorieId","setCategorieId","userLogin","state","userInfo","dispatch","categorieList","errorCategories","error","loadingCategories","loading","successCategories","success","categories","errorDetails","loadingDetails","successDetails","product","productUpdate","errorUpdate","loadingUpdate","successUpdate","type","push","_id","Number","img","categorie","uploadFileHandler","e","file","target","files","formData","FormData","append","config","headers","Authorization","token","post","data","console","log","submitHandler","preventDefault","category","minHeight","marginTop","width","value","undefined","map","maxWidth","maxHeight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport axios from \"axios\";\r\n\r\nimport { Button, Form, Image } from \"react-bootstrap\";\r\nimport FormContainer from \"../../components/FormContainer\";\r\n\r\nimport Loader from \"../../components/Loader\";\r\nimport Message from \"../../components/Message\";\r\nimport Paginator from \"../../components/Paginator\";\r\n\r\nimport {\r\n  productDetails as details,\r\n  updateProduct,\r\n} from \"../../actions/product_actions\";\r\nimport { listCategories } from \"../../actions/categorie_actions\";\r\nimport {\r\n  PRODUCT_DETAILS_RESET,\r\n  PRODUCT_UPDATE_RESET,\r\n} from \"../../constants/product_contants\";\r\nexport default function EditProductScreen({ match, history }) {\r\n  /*Vars for creation of product*/\r\n  const productId = match.params.id;\r\n  const [name, setName] = useState(\"\");\r\n  const [description, setDescription] = useState(\"\");\r\n  const [price, setPrice] = useState(0);\r\n  const [image, setImage] = useState(\"\");\r\n  const [inStock, setInStock] = useState();\r\n  const [isUploading, setIsUploading] = useState(false);\r\n\r\n  const [categorieName, setCategorieName] = useState();\r\n  const [categorieId, setCategorieId] = useState();\r\n  const userLogin = useSelector((state) => state.userLogin);\r\n  const { userInfo } = userLogin;\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  const categorieList = useSelector((state) => state.categorieList);\r\n  const {\r\n    error: errorCategories,\r\n    loading: loadingCategories,\r\n    success: successCategories,\r\n    categories,\r\n  } = categorieList;\r\n\r\n  const productDetails = useSelector((state) => state.productDetails);\r\n  const {\r\n    error: errorDetails,\r\n    loading: loadingDetails,\r\n    success: successDetails,\r\n    product,\r\n  } = productDetails;\r\n\r\n  const productUpdate = useSelector((state) => state.productUpdate);\r\n  const {\r\n    error: errorUpdate,\r\n    loading: loadingUpdate,\r\n    success: successUpdate,\r\n  } = productUpdate;\r\n\r\n  useEffect(() => {\r\n    dispatch(listCategories());\r\n    if (successUpdate) {\r\n      dispatch({ type: PRODUCT_UPDATE_RESET });\r\n      dispatch({ type: PRODUCT_DETAILS_RESET });\r\n      history.push(\"/admin/productos/\");\r\n    } else {\r\n      if (!product?.name || product._id !== Number(productId))\r\n        dispatch(details(productId));\r\n      else {\r\n        setName(product.name);\r\n        setDescription(product.description);\r\n        setPrice(product.price);\r\n        setImage(product.img);\r\n        setInStock(product.inStock);\r\n        setCategorieName(product.categorie[\"name\"]);\r\n        setCategorieId(product.categorie[\"_id\"]);\r\n      }\r\n    }\r\n  }, [product, productId, successUpdate, history, dispatch]);\r\n\r\n  const uploadFileHandler = async (e) => {\r\n    const file = e.target.files[0];\r\n    const formData = new FormData();\r\n\r\n    formData.append(\"image\", file);\r\n    formData.append(\"product_id\", productId);\r\n\r\n    setIsUploading(true);\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${userInfo.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.post(\r\n        \"/api/products/upload/\",\r\n        formData,\r\n        config\r\n      );\r\n      setImage(data);\r\n      setIsUploading(false);\r\n    } catch (error) {\r\n      console.log(error);\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n  const submitHandler = (e) => {\r\n    e.preventDefault();\r\n    dispatch(\r\n      updateProduct({\r\n        name: name,\r\n        _id: productId,\r\n        description: description,\r\n        category: categorieId,\r\n        price: price,\r\n        inStock: inStock,\r\n      })\r\n    );\r\n  };\r\n  return loadingDetails ? (\r\n    <div style={{ minHeight: \"100vh\", marginTop: \"15vh\" }}>\r\n      <Loader />\r\n    </div>\r\n  ) : errorDetails ? (\r\n    <div style={{ minHeight: \"100vh\", marginTop: \"15vh\" }}>\r\n      <Message variant=\"danger\">{errorDetails}</Message>\r\n    </div>\r\n  ) : (\r\n    <div style={{ marginTop: \"10vh\" }}>\r\n      <>\r\n        <FormContainer>\r\n          <h1 style={{ width: \"100%\" }}>Editar producto</h1>\r\n          <Form onSubmit={submitHandler}>\r\n            <Form.Group controlId=\"name\">\r\n              <Form.Label>Nombre</Form.Label>\r\n              <Form.Control\r\n                type=\"text\"\r\n                placeholder=\"Ingresa el nombre\"\r\n                value={name}\r\n                onChange={(e) => setName(e.target.value)}\r\n              ></Form.Control>\r\n            </Form.Group>\r\n            <Form.Group controlId=\"desc\">\r\n              <Form.Label>Descripción</Form.Label>\r\n              <Form.Control\r\n                as=\"textarea\"\r\n                rows={3}\r\n                placeholder=\"Ingresa los detalles\"\r\n                value={description}\r\n                onChange={(e) => setDescription(e.target.value)}\r\n              ></Form.Control>\r\n            </Form.Group>\r\n            <Form.Group controlId=\"name\">\r\n              <Form.Label>Precio</Form.Label>\r\n              <Form.Control\r\n                type=\"number\"\r\n                placeholder=\"Ingresa el precio\"\r\n                value={price}\r\n                onChange={(e) => setPrice(e.target.value)}\r\n              ></Form.Control>\r\n            </Form.Group>\r\n\r\n            <Form.Group controlId=\"categorie\">\r\n              <Form.Label>Categoría</Form.Label>\r\n              <Form.Control\r\n                as=\"select\"\r\n                custom\r\n                onChange={(e) => setCategorieId(e.target.value)}\r\n              >\r\n                {successCategories && (\r\n                  <>\r\n                    <option selected={categorieId == undefined}>\r\n                      Selecciona una categoria\r\n                    </option>\r\n                    {categories?.map((categorie) => (\r\n                      <option\r\n                        value={categorie._id}\r\n                        selected={categorieId === categorie._id ? true : false}\r\n                      >\r\n                        {categorie.name}\r\n                      </option>\r\n                    ))}\r\n                  </>\r\n                )}\r\n              </Form.Control>\r\n            </Form.Group>\r\n            <Form.Group controlId=\"image\">\r\n              <Form.Label>Imagen</Form.Label>\r\n              <div className=\"d-flex align-items-center w-100 justify-content-center\">\r\n                {product?.img && (\r\n                  <Image\r\n                    className=\"d-block my-4 shadow\"\r\n                    style={{ maxWidth: \"330px\", maxHeight: \"250px\" }}\r\n                    xs={6}\r\n                    md={4}\r\n                    src={`https://res.cloudinary.com/majo-floral-desing/${product.img}`}\r\n                  />\r\n                )}\r\n              </div>\r\n              <Form.Control\r\n                type=\"text\"\r\n                placeholder=\"Ingresa la imagen\"\r\n                value={image}\r\n                onChange={(e) => setImage(e.target.value)}\r\n                readOnly={true}\r\n              ></Form.Control>\r\n              <Form.File\r\n                id=\"image-file\"\r\n                label=\"Elegir un archivo\"\r\n                custom\r\n                onChange={uploadFileHandler}\r\n              ></Form.File>\r\n              {isUploading && <Loader />}\r\n            </Form.Group>\r\n            <Form.Group controlId=\"stock\">\r\n              <Form.Check\r\n                type={\"checkbox\"}\r\n                label={\"¿Disponible en stock?\"}\r\n                checked={inStock}\r\n                onChange={(e) => setInStock(!inStock)}\r\n              ></Form.Check>\r\n            </Form.Group>\r\n            {loadingUpdate ? (\r\n              <Loader />\r\n            ) : errorUpdate ? (\r\n              categorieId == undefined ? (\r\n                <>\r\n                  <Message variant=\"danger\">Selecciona una categoría</Message>\r\n                  <Button variant=\"primary\" type=\"submit\">\r\n                    Actualizar\r\n                  </Button>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Message variant=\"danger\">{errorUpdate}</Message>\r\n                  <Button variant=\"primary\" type=\"submit\">\r\n                    Actualizar\r\n                  </Button>\r\n                </>\r\n              )\r\n            ) : (\r\n              <Button variant=\"primary\" type=\"submit\">\r\n                Actualizar\r\n              </Button>\r\n            )}\r\n          </Form>\r\n        </FormContainer>\r\n      </>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}